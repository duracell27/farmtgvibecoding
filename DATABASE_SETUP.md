# –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è –±–∞–∑–∏ –¥–∞–Ω–∏—Ö MongoDB

## üéØ –û–≥–ª—è–¥

–í–∞—à –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ —Ç–µ–ø–µ—Ä –ø—ñ–¥—Ç—Ä–∏–º—É—î –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è –ø—Ä–æ–≥—Ä–µ—Å—É –≥—Ä–∏ –≤ MongoDB Atlas –∑ –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ—é —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—î—é –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥.

## üìã –©–æ –±—É–ª–æ –¥–æ–¥–∞–Ω–æ

### 1. MongoDB —ñ–Ω—Ç–µ–≥—Ä–∞—Ü—ñ—è
- ‚úÖ –ü—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ MongoDB Atlas
- ‚úÖ API endpoints –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è/–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
- ‚úÖ –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥
- ‚úÖ –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å—É —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –≤ UI

### 2. –ù–æ–≤—ñ —Ñ–∞–π–ª–∏
- `src/lib/mongodb.ts` - –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ –ë–î
- `src/app/api/game/save/route.ts` - API –¥–ª—è –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
- `src/app/api/game/load/route.ts` - API –¥–ª—è –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
- `src/hooks/useGameSync.ts` - —Ö—É–∫ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó

### 3. –ú–æ–¥–∏—Ñ—ñ–∫–æ–≤–∞–Ω—ñ —Ñ–∞–π–ª–∏
- `src/store/gameStore.ts` - –¥–æ–¥–∞–Ω–æ —Ñ—É–Ω–∫—Ü—ñ—ó —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
- `src/types/game.ts` - –¥–æ–¥–∞–Ω–æ —Ç–∏–ø–∏ –¥–ª—è —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
- `src/components/Header.tsx` - –¥–æ–¥–∞–Ω–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
- `src/app/page.tsx` - —ñ–Ω—Ç–µ–≥—Ä–æ–≤–∞–Ω–æ —Ö—É–∫ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó

## üîß –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è

### 1. –°—Ç–≤–æ—Ä—ñ—Ç—å —Ñ–∞–π–ª `.env.local`
```bash
MONGODB_URI=mongodb+srv://volodymyrshmidt_db_user:UhhdMBMsJAsUnkO2@cluster0.cs3a9ge.mongodb.net/
MONGODB_DB=farm_game
```

### 2. –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
```javascript
// –ö–æ–ª–µ–∫—Ü—ñ—è: game_states
{
  _id: ObjectId,
  userId: "123456789", // Telegram user ID
  gameState: {
    user: { level: 5, experience: 120, coins: 150, ... },
    warehouse: { dill: 10, parsley: 5, ... },
    farmPlots: [...],
    achievements: [...],
    // –≤–µ—Å—å —Å—Ç–∞–Ω –≥—Ä–∏
  },
  lastUpdated: ISODate,
  createdAt: ISODate
}
```

## ‚ö° –Ø–∫ –ø—Ä–∞—Ü—é—î —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è

### –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è
- **–Ü–Ω—Ç–µ—Ä–≤–∞–ª**: –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥
- **–£–º–æ–≤–∞**: —Ç—ñ–ª—å–∫–∏ —è–∫—â–æ —î –≤–∞–ª—ñ–¥–Ω–∏–π Telegram user ID
- **Debounce**: –º—ñ–Ω—ñ–º—É–º 5 —Å–µ–∫—É–Ω–¥ –º—ñ–∂ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è–º–∏

### –†—É—á–Ω–µ –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
- –ü—Ä–∏ –∑–±–æ—Ä—ñ —É—Ä–æ–∂–∞—é
- –ü—Ä–∏ –ø—Ä–æ–¥–∞–∂—É –ø—Ä–æ–¥—É–∫—Ç—ñ–≤
- –ü—Ä–∏ —Ä–æ–∑–±–ª–æ–∫—É–≤–∞–Ω–Ω—ñ –≥—Ä—è–¥–æ–∫
- –ü—Ä–∏ –≤–∏–±–æ—Ä—ñ —Ç–∏–ø—É —Ä–æ—Å–ª–∏–Ω–∏
- –ü—Ä–∏ –∑–º—ñ–Ω—ñ –∞–∫—Ç–∏–≤–Ω–æ—ó –≤–∫–ª–∞–¥–∫–∏
- –ü—Ä–∏ –∑–∞–∫—Ä–∏—Ç—Ç—ñ —Å—Ç–æ—Ä—ñ–Ω–∫–∏ (beforeunload)

### –ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –∑–∞–ø—É—Å–∫—É –≥—Ä–∏
- –¢—ñ–ª—å–∫–∏ –¥–ª—è –≤–∞–ª—ñ–¥–Ω–∏—Ö Telegram –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á—ñ–≤
- –í—ñ–¥–Ω–æ–≤–ª—é—î –≤–∏–±—Ä–∞–Ω–∏–π —Ç–∏–ø —Ä–æ—Å–ª–∏–Ω–∏
- –í—ñ–¥–Ω–æ–≤–ª—é—î –∞–∫—Ç–∏–≤–Ω—É –≤–∫–ª–∞–¥–∫—É

## üéÆ –Ü–Ω–¥–∏–∫–∞—Ç–æ—Ä–∏ –≤ UI

–í Header –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ñ –¥–æ–¥–∞–Ω–æ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å—Ç–∞—Ç—É—Å—É:
- üîÑ "–ó–±–µ—Ä–µ–∂–µ–Ω–Ω—è..." - –ø—Ä–æ—Ü–µ—Å –∑–±–µ—Ä–µ–∂–µ–Ω–Ω—è
- üîÑ "–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è..." - –ø—Ä–æ—Ü–µ—Å –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
- ‚ö†Ô∏è "–ü–æ–º–∏–ª–∫–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó" - –ø–æ–º–∏–ª–∫–∞
- ‚úÖ "–°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–æ–≤–∞–Ω–æ" - —É—Å–ø—ñ—à–Ω–∞ —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è

## üöÄ –î–µ–ø–ª–æ–π

### –î–ª—è Vercel:
1. –î–æ–¥–∞–π—Ç–µ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –≤ Vercel Dashboard:
   - `MONGODB_URI` = –≤–∞—à connection string
   - `MONGODB_DB` = `farm_game`

2. –î–µ–ø–ª–æ–π:
```bash
vercel --prod
```

### –î–ª—è —ñ–Ω—à–∏—Ö –ø–ª–∞—Ç—Ñ–æ—Ä–º:
–î–æ–¥–∞–π—Ç–µ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞ –≤—ñ–¥–ø–æ–≤—ñ–¥–Ω–æ –¥–æ –≤–∞—à–æ—ó –ø–ª–∞—Ç—Ñ–æ—Ä–º–∏.

## üîç –¢–µ—Å—Ç—É–≤–∞–Ω–Ω—è

1. –í—ñ–¥–∫—Ä–∏–π—Ç–µ –∑–∞—Å—Ç–æ—Å—É–Ω–æ–∫ –≤ Telegram –∞–±–æ –±—Ä–∞—É–∑–µ—Ä—ñ
2. –ó—Ä–æ–±—ñ—Ç—å –∫—ñ–ª—å–∫–∞ –¥—ñ–π (–ø–æ—Å–∞–¥—ñ—Ç—å —Ä–æ—Å–ª–∏–Ω–∏, –∑–±–µ—Ä—ñ—Ç—å —É—Ä–æ–∂–∞–π)
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —ñ–Ω–¥–∏–∫–∞—Ç–æ—Ä —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –≤ Header
4. –ü–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂—Ç–µ —Å—Ç–æ—Ä—ñ–Ω–∫—É - –ø—Ä–æ–≥—Ä–µ—Å –ø–æ–≤–∏–Ω–µ–Ω –∑–±–µ—Ä–µ–≥—Ç–∏—Å—è
5. –í –ª–æ–≥–∞—Ö —Å–µ—Ä–≤–µ—Ä–∞ –≤–∏ –ø–æ–±–∞—á–∏—Ç–µ –∑–∞–ø–∏—Ç–∏ –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥

## üìä –ü–µ—Ä–µ–≤–∞–≥–∏

- **–ù–∞–¥—ñ–π–Ω—ñ—Å—Ç—å**: –ø—Ä–æ–≥—Ä–µ—Å –Ω–µ –≤—Ç—Ä–∞—á–∞—î—Ç—å—Å—è –ø—Ä–∏ –ø–µ—Ä–µ–∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—ñ
- **–û–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è**: —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –∫–æ–∂–Ω—ñ 30 —Å–µ–∫—É–Ω–¥, –Ω–µ –Ω–∞–≤–∞–Ω—Ç–∞–∂—É—î –ë–î
- **UX**: –∫–æ—Ä–∏—Å—Ç—É–≤–∞—á –±–∞—á–∏—Ç—å —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó
- **–ë–µ–∑–ø–µ–∫–∞**: –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è Telegram user ID —è–∫ —É–Ω—ñ–∫–∞–ª—å–Ω–∏–π —ñ–¥–µ–Ω—Ç–∏—Ñ—ñ–∫–∞—Ç–æ—Ä

## üõ†Ô∏è –ù–∞–ª–∞—à—Ç—É–≤–∞–Ω–Ω—è —ñ–Ω—Ç–µ—Ä–≤–∞–ª—É

–Ø–∫—â–æ —Ö–æ—á–µ—Ç–µ –∑–º—ñ–Ω–∏—Ç–∏ —ñ–Ω—Ç–µ—Ä–≤–∞–ª —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó, –≤—ñ–¥—Ä–µ–¥–∞–≥—É–π—Ç–µ —Ñ–∞–π–ª `src/hooks/useGameSync.ts`:

```typescript
// –ó–º—ñ–Ω—ñ—Ç—å 30000 –Ω–∞ –ø–æ—Ç—Ä—ñ–±–Ω–∏–π —ñ–Ω—Ç–µ—Ä–≤–∞–ª –≤ –º—ñ–ª—ñ—Å–µ–∫—É–Ω–¥–∞—Ö
syncIntervalRef.current = setInterval(() => {
  debouncedSave();
}, 30000); // 30 —Å–µ–∫—É–Ω–¥
```

## üîß –£—Å—É–Ω–µ–Ω–Ω—è –Ω–µ–ø–æ–ª–∞–¥–æ–∫

### –°–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—è –Ω–µ –ø—Ä–∞—Ü—é—î:
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ connection string MongoDB
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –∫–æ–Ω—Å–æ–ª—å –±—Ä–∞—É–∑–µ—Ä–∞ –Ω–∞ –ø–æ–º–∏–ª–∫–∏

### –î–∞–Ω—ñ –Ω–µ –∑–±–µ—Ä—ñ–≥–∞—é—Ç—å—Å—è:
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ —î –≤–∞–ª—ñ–¥–Ω–∏–π Telegram user ID
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —Å—Ç–∞—Ç—É—Å —Å–∏–Ω—Ö—Ä–æ–Ω—ñ–∑–∞—Ü—ñ—ó –≤ Header
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ª–æ–≥–∏ API –≤ –∫–æ–Ω—Å–æ–ª—ñ

### –ü–æ–º–∏–ª–∫–∏ –≤ –∫–æ–Ω—Å–æ–ª—ñ:
1. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—ñ–¥–∫–ª—é—á–µ–Ω–Ω—è –¥–æ MongoDB Atlas
2. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ –ø—Ä–∞–≤–∞ –¥–æ—Å—Ç—É–ø—É –¥–æ –±–∞–∑–∏ –¥–∞–Ω–∏—Ö
3. –ü–µ—Ä–µ–≤—ñ—Ä—Ç–µ —á–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–æ –Ω–∞–ª–∞—à—Ç–æ–≤–∞–Ω—ñ –∑–º—ñ–Ω–Ω—ñ —Å–µ—Ä–µ–¥–æ–≤–∏—â–∞
